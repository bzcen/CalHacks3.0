<!DOCTYPE html>
<html lang="en" ng-app="charityStatement">
	<head>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous">
		<link href="/css/custom.css" rel="stylesheet">
		<link href="/css/button.css" rel="stylesheet">
	    <script src="https://www.gstatic.com/firebasejs/3.6.0/firebase.js"></script>
	    <script src="https://www.gstatic.com/firebasejs/3.5.2/firebase-app.js"></script>
	    <script src="https://www.gstatic.com/firebasejs/3.5.2/firebase-auth.js"></script>
	    <script src="https://www.gstatic.com/firebasejs/3.6.0/firebase-database.js"></script>
	    <script src="https://www.gstatic.com/firebasejs/ui/live/1.0/firebase-ui-auth.js"></script>
	</head>
	<body  style="background-color: #001f3f">
		<div id="sentiment" style="display: none;">1</div>
		<div id="sadness" style="display: none;">0.05</div>
		<div id="joy" style="display: none;">.9</div>
		<div id="anger" style="display: none;">.3</div>
 		<div id="fear" style="display: none;">.45</div>
		<div id="disgust" style="display: none;">.2</div>

        <div id="bgcity" class="jumbotron text-center">
        	<div id="titleText">
                <h1 id="namefield" class = "button" style="color: #000000"><%= name %></h1>
            </div>
        </div>

		<div style="color: #ffffff" class="container">
		  <!-- Example row of columns -->
		  <div class="row">
			<div class="col-md-6">
			  <h2>Description</h2>
			  <p id="description">Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
              <script>
                 var obj=  {"id": 8,"values" : [{"name": "Red Cross","desc": "The American Red Cross, also known as the American     National Red Cross, is a humanitarian organization that provides emergency  assistance, disaster relief and education in the United States.", "img": "https://www.redcross.org/images/                        MEDIA_CustomProductCatalog/m48040100_ButtonLogo200.jpg"},{"name": "Hope For Haiti", "desc": "We work to improve the quality of life for the         Haitian people, particularly children.", "img": "http://www.thecreativebodega.com/nicheonline/wp-        content/uploads/2013/04/hope-for-haiti.jpg"},{"name": "Feeding America", "desc": "Feeding America is a hunger organization with a        nationwide network of food banks feeding the hungry.", "img": "https://upload.wikimedia.org/wikipedia/en/thumb/a/aa/   Feeding_America_logo.svg/1280px-Feeding_America_logo.svg.png"},{"name": "Salvation Army","desc": "The Salvation Army is a Christian church and           international charitable organisation structured in a quasi-military        fashion.","img": "https://upload.wikimedia.org/wikipedia/en/thumb/c/c4/   The_Salvation_Army.svg/868px-The_Salvation_Army.svg.png" }, {"name": "YMCA", "desc": "YMCA programs celebrate and honor common values of     respect, responsibility, honesty, and caring by infusing character          development into programs.", "img": "https://www.ymcamn.org/themes/custom/ymca/img/ymca-     logo-social.png"}, {"name": "United Way", "desc": "United Way Worldwide is the leadership and support     organization for the network of nearly 1,800 community-based United Ways    in 45 countries and territories.","img": "http://unitedwaysuwanneevalley.org/images/united-way-   lock-up-rgb%20(Small).jpg"},{"name": "American Civil Liberties Union","desc": "The American Civil Liberties Union (ACLU) is a         national organization that works daily in courts, legislatures and          communities to defend the individual rights of the people.","img": "http://unitedwaysuwanneevalley.org/images/united-way-   lock-up-rgb%20(Small).jpg" },{ "name": "Asian Americans Advancing Justice","desc": "A non-profit legal aid and civil rights organization   dedicated to advocating for civil rights, providing legal services and      education for APAs","img": "https://www.advancingjustice.org/images/AAAJ_website.   jpg"}]} ;

				var name = document.getElementById("namefield").innerHTML;
				console.log(name);

				//Check against JSONFILE
				for (var i = 0; i < obj.id; i++) {
					if (obj.values[i].name.toLowerCase() == name.toLowerCase())
					{
						document.getElementById("description").innerHTML = obj.values[i].desc;
					}
				}

              </script>
			  <h3>Similar Charities</h3>
			  <!--<button type="button" class="btn btn-success" onclick="location.href='/payment'">Donate Now</button>-->
			  <script>
			var config = {
			        apiKey: "AIzaSyDEiQ7mFRi2KuuaLUP3IBL780A2B2Nuago",
			        authDomain: "charitystatement.firebaseapp.com",
			        databaseURL: "https://charitystatement.firebaseio.com",
			        storageBucket: "charitystatement.appspot.com",
			        messagingSenderId: "693936859765"
			      };

			      firebase.initializeApp(config);
			      console.log("firebase loaded.. description");
			  var fbUser;
		      firebase.auth().onAuthStateChanged(function(user) {
		        fbUser = user;
		        if(user) {
		          console.log("log in successful");          
		        } else {
		          console.log("signed out");
		        }
		      });

			   var donate = function() {
			   	//is called
			   		console.log('inside donate');
				   	var database = firebase.database().ref('/');
				    if(fbUser) {
				      console.log('fbUser id: ' + fbUser.uid);
				      database = database.child(fbUser.uid);
				      //database.ref('ref/').set(document.getElementById('sq-expiration-date').value);
				      
				      database.once('value').then(function(snapshot) {
				       var update = {};
				       snapshot.forEach(function(childSnapshot) {
				         update[childSnapshot.key] = childSnapshot.val();
				         console.log("key: " + childSnapshot.key + ", val: " + childSnapshot.val());
				       });
				       //update[search] = search;
				       //update['sq-expiration-date'] = document.getElementById('sq-expiration-date').value;
				       update['test'] = 'test';
				       database.update(update).then(() => {
				        console.log("successful");
     				   	window.location.href = '/payment';
				       }).catch(error => {console.log("failed")});
				      }).catch(function(error) {
				       console.log('failed to update database', error);
				      });
				    }

			   }
			 
			  </script>
			  <button type="button" class="btn btn-success" onclick="donate()">Donate Now</button>
		   </div>
			<div class="col-md-6">
			  <h2>Sentiment Score</h2>
			  <div style="text-align:middle;">
			  			  <!-- ripped from html5 canvas tutorials -->
			<canvas id="myCanvas" width="200" height="200" ></canvas>
				<script>
					      var canvas = document.getElementById('myCanvas');
					      var s = document.getElementById('sentiment').innerHTML;

					      var context = canvas.getContext('2d');
					      var centerX = canvas.width / 2;
					      var centerY = canvas.height / 2;
					      var radius = 70;

					      context.beginPath();
					      context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
					      console.log(s);
					      if (s >= 0.5) {
					      	context.fillStyle = '#97dd7e';
					      	context.strokeStyle = '#5e9949';
					      } else if (s >= 0) {
					      	context.fillStyle = '#f1f489';
					      	context.strokeStyle = '#dbc27f';
					      } else if (s >= -0.5) {
					      	context.fillStyle = '#cc926c';
					      	context.strokeStyle = '#d66f46';
					      } else {
					      	context.fillStyle = '#ad4743';
					      	context.strokeStyle = '#871511';
					      }
					      context.fill();
					      context.lineWidth = 5;
					      context.stroke();

					      context.textAlign = 'center';
					      context.font = '40pt Helvetica'
					                  context.fillStyle = 'white';
            				context.fillText(s, centerX, centerY+24);


					    </script>
					    <p style="display: inline-block; vertical-align: middle;">testing</p>
					</div>
			  <h3>Keyword Analysis</h3>
			  <h3>Tone Analysis</h3>
			  <!-- <p> <%= sentiment %> </p>
			  <p style="color:#5cb85c"> <%= joy %> </p>

				<p style="color:#990000"> <%= sadness %> </p>

			  <p style="color:#990000"> <%= anger %> </p>

			  <p style="color:#990000"> <%= disgust %> </p>

			  <p style="color:#990000"> <%= fear %> </p> -->

				<style>

	.chart div {
	  font: 10px sans-serif;
	  background-color: steelblue;
	  text-align: right;
	  padding: 3px;
	  margin: 1px;
	  color: white;
	}

	</style>
	<div class="chart"></div>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script>
	var sadness = {
		'name': 'sadness',
		'val': document.getElementById("sadness").innerHTML
	}
	var joy = {
		'name': 'joy',
		'val': document.getElementById("joy").innerHTML
	}
	var anger = {
		'name': 'anger',
		'val': document.getElementById("anger").innerHTML
	}
	var fear = {
		'name': 'fear',
		'val': document.getElementById("fear").innerHTML
	}
	var disgust = {
		'name': 'disgust',
		'val': document.getElementById("disgust").innerHTML
	}
	var data = [joy, sadness, anger, fear, disgust];

	var x = d3.scale.linear()
	    .domain([0, d3.max(data)])
	    .range([0, 30]);

	d3.select(".chart")
	  .selectAll("div")
	    .data(data)
	  .enter().append("div")
	    .style("width", function(d) { return d.val * 500 + "px"; })
			.style("height", "50px")
			.style("text-align", "right")
			.style("font-size", "12px")
	    .text(function(d) { return d.val + " " + d.name; })

			d3.select(".chart")
				.selectAll("div")[0][0]
					.style.backgroundColor = "#5cb85c";

			d3.select(".chart")
				.selectAll("div")[0][1]
					.style.backgroundColor = "#990000";

			d3.select(".chart")
				.selectAll("div")[0][2]
					.style.backgroundColor = "#990000";

			d3.select(".chart")
				.selectAll("div")[0][3]
					.style.backgroundColor = "#990000";

			d3.select(".chart")
				.selectAll("div")[0][4]
					.style.backgroundColor = "#990000";

	</script>

								</div>
							  </div>

		<!-- post-loaded dependencies -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/js/bootstrap.min.js" integrity="sha384-BLiI7JTZm+JWlgKa0M0kGRpJbF2J8q+qreVrKBC47e3K6BW78kGLrCkeRX6I9RoK" crossorigin="anonymous"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular-sanitize.js"></script>
	</body>
</html>
